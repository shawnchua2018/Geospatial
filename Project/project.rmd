---
title: "Project"
author: "Chua Jun Yong Shawn"
date: "10/24/2020"
output: html_document
---

# Loading Packages 
```{r echo=TRUE, warning= FALSE}
packages = c('sp', 'rgdal', 'rgeos', 'sf', 'tidyverse', 'olsrr', 'corrplot', 'ggpubr', 'sf', 'spdep', 'GWmodel', 'tmap', 'tidyverse', 'raster')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

# Importing Datasets
CSV File: Resale flat Prices (2020 onwards)
```{r echo=TRUE, message=FALSE, warning= FALSE}
resale_flat = st_read("data/aspatial/Resale_flats_compiled.csv")

resale_flat$latitude <- as.numeric(resale_flat$latitude)
resale_flat$longitude <- as.numeric(resale_flat$longitude)

cord.dec = SpatialPoints(cbind(resale_flat$longitude, resale_flat$latitude), proj4string=CRS("+proj=longlat"))

cord.UTM <- spTransform(cord.dec, CRS("+init=epsg:3414"))
cord.UTM

new_coords <- data.frame(cord.UTM@coords)
summary(new_coords)
new_coords <- new_coords %>%
  rename(X = coords.x1, Y = coords.x2)

resale_flat <- cbind(resale_flat, "X" = new_coords[1], "Y" = new_coords[2])

sf_resale_flat <- st_as_sf(resale_flat, coords = c("X","Y"),crs= 3414)
```

kml Files: 
```{r echo=TRUE, message=FALSE, warning= FALSE}
preschool = st_read("data/geospatial/pre-schools-location-kml.kml")

hawkercenter = st_read("data/geospatial/hawker-centres-kml.kml")

cc = st_read("data/geospatial/community-clubs-kml.kml")

parks = st_read("data/geospatial/nparks-parks-kml.kml")

supermarket = st_read("data/geospatial/supermarkets-kml.kml")

sport_facilities = st_read("data/geospatial/sportsg-sport-facilities-kml.kml")

sf_mpsz2019 = st_read("data/geospatial/master-plan-2019-subzone-boundary-no-sea-kml.kml")

```

Shapefile : 
```{r echo=TRUE, message=FALSE, warning= FALSE}
mrt <- shapefile("data/geospatial/MRTLRTStnPtt.shp")
mrt <- st_as_sf(mrt, coords = c("XCOORD", "YCOORD"), crs=3414)
mrt <- st_transform(mrt,3414)
st_crs(mrt)
st_is_longlat(mrt)
```


# Updating CRS information
```{r echo=TRUE, message=FALSE, warning= FALSE}
preschool_svy21 <- st_transform(preschool,3414)
st_crs(preschool_svy21)

hawkercenter_svy21 <- st_transform(hawkercenter, 3414)
st_crs(hawkercenter_svy21)

cc_svy21 <- st_transform(cc, 3414)
st_crs(cc_svy21)

parks_svy21 <- st_transform(parks, 3414)
st_crs(parks_svy21)

supermarket_svy21 <- st_transform(supermarket, 3414)
st_crs(supermarket_svy21)

sport_facilities_svy21 <- st_transform(sport_facilities, 3414)
st_crs(sport_facilities_svy21)

mpsz2019_svy21 <- st_transform(sf_mpsz2019, 3414)
st_crs(mpsz2019_svy21)

```


# Filter resale flat data to remove unwanted columns
```{r echo=TRUE, message=FALSE, warning= FALSE}
resale_flat <- resale_flat %>%
  dplyr::select(`town`, `address`, `latitude`, `longitude`, `storey_range`, `floor_area_sqm`, `remaining_lease`, `resale_price`)
```

```{r echo=TRUE, message=FALSE, warning= FALSE}
#prox_count <- function(slider_value, variable) {
  #buffer_zone <- st_buffer(resale_flat, slider_value)
  #resale_flat <- lengths(st_intersects(buffer_zone, variable))
#}
buffer_zone <- st_buffer(sf_resale_flat, 250)
sf_resale_flat$count <- lengths(st_intersects(buffer_zone, mrt))
```

```{r echo=TRUE, message=FALSE, warning= FALSE}
tm_shape(sf_resale_flat)+
  tm_bubbles(col = "red",
           size = 1,
           border.col = "black",
           border.lwd = 1)


```