---
title: "Project"
author: "Chua Jun Yong Shawn"
date: "10/24/2020"
output: html_document
---

# Loading Packages 
```{r echo=TRUE, warning= FALSE}
packages = c('sp', 'rgdal', 'rgeos', 'sf', 'tidyverse', 'olsrr', 'corrplot', 'ggpubr', 'sf', 'spdep', 'GWmodel', 'tmap', 'tidyverse', 'raster')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

# Importing Datasets
CSV File: Resale flat Prices (2020 onwards)
```{r echo=TRUE, message=FALSE, warning= FALSE}
resale_flat = st_read("data/aspatial/Resale_flats_compiled.csv")

resale_flat$latitude <- as.numeric(resale_flat$latitude)
resale_flat$longitude <- as.numeric(resale_flat$longitude)

cord.dec = SpatialPoints(cbind(resale_flat$longitude, resale_flat$latitude), proj4string=CRS("+proj=longlat"))

cord.UTM <- spTransform(cord.dec, CRS("+init=epsg:3414"))
cord.UTM

new_coords <- data.frame(cord.UTM@coords)
summary(new_coords)
new_coords <- new_coords %>%
  rename(X = coords.x1, Y = coords.x2)

resale_flat <- cbind(resale_flat, "X" = new_coords[1], "Y" = new_coords[2])

resale_flat = resale_flat[,!(names(resale_flat) %in% c("month","flat_model","lease_commence_date","longitude","latitude"))]

sf_resale_flat <- st_as_sf(resale_flat, coords = c("X","Y"),crs= 3414)
```
Schools CSV
```{r echo=TRUE, message=FALSE, warning= FALSE}
school = st_read("data/aspatial/Schools.csv")

school$latitude <- as.numeric(school$latitude)
school$longitude <- as.numeric(school$longitude)

cord.dec.sch = SpatialPoints(cbind(school$longitude, school$latitude), proj4string=CRS("+proj=longlat"))

cord.UTM.sch <- spTransform(cord.dec.sch, CRS("+init=epsg:3414"))
cord.UTM.sch

new_coords_sch <- data.frame(cord.UTM.sch@coords)
summary(new_coords_sch)
new_coords_sch <- new_coords_sch %>%
  rename(X = coords.x1, Y = coords.x2)

school <- cbind(school, "X" = new_coords_sch[1], "Y" = new_coords_sch[2])

sf_school <- st_as_sf(school, coords = c("X","Y"),crs= 3414)
```

Shopping Malls CSV 
```{r echo=TRUE, message=FALSE, warning= FALSE}
mall = st_read("data/aspatial/Shopping_Malls.csv")

mall$latitude <- as.numeric(mall$latitude)
mall$longitude <- as.numeric(mall$longitude)

cord.dec.mall = SpatialPoints(cbind(mall$longitude, mall$latitude), proj4string=CRS("+proj=longlat"))

cord.UTM.mall <- spTransform(cord.dec.mall, CRS("+init=epsg:3414"))
cord.UTM.mall

new_coords_mall <- data.frame(cord.UTM.mall@coords)
summary(new_coords_mall)
new_coords_mall <- new_coords_mall %>%
  rename(X = coords.x1, Y = coords.x2)

mall <- cbind(mall, "X" = new_coords_mall[1], "Y" = new_coords_mall[2])

sf_mall <- st_as_sf(mall, coords = c("X","Y"),crs= 3414)
```

kml Files: 
```{r echo=TRUE, message=FALSE, warning= FALSE}
preschool = st_read("data/geospatial/pre-schools-location-kml.kml")

hawkercenter = st_read("data/geospatial/hawker-centres-kml.kml")

cc = st_read("data/geospatial/community-clubs-kml.kml")

parks = st_read("data/geospatial/nparks-parks-kml.kml")

supermarket = st_read("data/geospatial/supermarkets-kml.kml")

sport_facilities = st_read("data/geospatial/sportsg-sport-facilities-kml.kml")

sf_mpsz2019 = st_read("data/geospatial/master-plan-2019-subzone-boundary-no-sea-kml.kml")

```

Changing to X,Y
```{r echo=TRUE, message=FALSE, warning= FALSE}
cc <- cc %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")

cc_coords <- data.frame(st_coordinates(cc))

cord.dec.cc = SpatialPoints(cbind(cc_coords$X, cc_coords$Y), proj4string=CRS("+proj=longlat"))

cord.UTM.cc <- spTransform(cord.dec.cc, CRS("+init=epsg:3414"))
new_cc <- data.frame(cord.UTM.cc)

new_cc <- new_cc %>%
  rename(X = coords.x1, Y = coords.x2)

parks <- parks %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")

parks_coords <- data.frame(st_coordinates(parks))

cord.dec.parks = SpatialPoints(cbind(parks_coords$X, parks_coords$Y), proj4string=CRS("+proj=longlat"))

cord.UTM.parks <- spTransform(cord.dec.parks, CRS("+init=epsg:3414"))
new_parks <- data.frame(cord.UTM.parks)

new_parks <- new_parks %>%
  rename(X = coords.x1, Y = coords.x2)

preschool <- preschool %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")

preschool_coords <- data.frame(st_coordinates(preschool))

cord.dec.preschool = SpatialPoints(cbind(preschool_coords$X, preschool_coords$Y), proj4string=CRS("+proj=longlat"))

cord.UTM.preschool <- spTransform(cord.dec.preschool, CRS("+init=epsg:3414"))
new_preschool <- data.frame(cord.UTM.preschool)

new_preschool <- new_preschool %>%
  rename(X = coords.x1, Y = coords.x2)

sport_facilities <- sport_facilities %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")

sport_facilities_coords <- data.frame(st_coordinates(sport_facilities))

cord.dec.sport_facilities = SpatialPoints(cbind(sport_facilities_coords$X, sport_facilities_coords$Y), proj4string=CRS("+proj=longlat"))

cord.UTM.sport_facilities <- spTransform(cord.dec.sport_facilities, CRS("+init=epsg:3414"))
new_sport_facilities <- data.frame(cord.UTM.sport_facilities)

new_sport_facilities <- new_sport_facilities %>%
  rename(X = coords.x1, Y = coords.x2)

supermarket <- supermarket %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")

supermarket_coords <- data.frame(st_coordinates(supermarket))

cord.dec.supermarket = SpatialPoints(cbind(supermarket_coords$X, supermarket_coords$Y), proj4string=CRS("+proj=longlat"))

cord.UTM.supermarket <- spTransform(cord.dec.supermarket, CRS("+init=epsg:3414"))
new_supermarket <- data.frame(cord.UTM.supermarket)

new_supermarket <- new_supermarket %>%
  rename(X = coords.x1, Y = coords.x2)

hawkercenter <- hawkercenter %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")

hawkercenter_coords <- data.frame(st_coordinates(hawkercenter))

cord.dec.hawkercenter = SpatialPoints(cbind(hawkercenter_coords$X, hawkercenter_coords$Y), proj4string=CRS("+proj=longlat"))

cord.UTM.hawkercenter <- spTransform(cord.dec.hawkercenter, CRS("+init=epsg:3414"))
new_hawkercenter <- data.frame(cord.UTM.hawkercenter)

new_hawkercenter <- new_hawkercenter %>%
  rename(X = coords.x1, Y = coords.x2)
```

Shapefile : 
```{r echo=TRUE, message=FALSE, warning= FALSE}
mrt <- shapefile("data/geospatial/MRTLRTStnPtt.shp")
mrt <- st_as_sf(mrt, coords = c("XCOORD", "YCOORD"), crs=3414)
mrt <- st_transform(mrt,3414)
st_crs(mrt)
st_is_longlat(mrt)
```

Converting all to SF
```{r echo=TRUE, message=FALSE, warning= FALSE}
sf_parks <- st_as_sf(new_parks, coords = c("X","Y"),crs= 3414)
sf_hawkercenter <- st_as_sf(new_hawkercenter, coords = c("X","Y"),crs= 3414)
sf_preschool <- st_as_sf(new_preschool, coords = c("X","Y"),crs= 3414)
sf_sport_facilities <- st_as_sf(new_sport_facilities, coords = c("X","Y"),crs= 3414)
sf_cc <- st_as_sf(new_cc, coords = c("X","Y"),crs= 3414)
sf_supermarket <- st_as_sf(new_supermarket, coords = c("X","Y"),crs= 3414)
```

Creation of buffer zone code and count
```{r echo=TRUE, message=FALSE, warning= FALSE}
buffer_zone <- st_buffer(sf_resale_flat, 250)
sf_resale_flat$sf_hawkercenter <- lengths(st_intersects(buffer_zone, sf_hawkercenter))

```
